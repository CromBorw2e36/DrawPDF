<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Page Break Per Item</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="../jspdf-service.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        button {
            background: #007acc;
            color: white;
            border: none;
            padding: 10px 15px;
            margin: 5px;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover {
            background: #005a9c;
        }
        .highlight {
            background: #4CAF50;
            font-weight: bold;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background-color: #f9f9f9;
        }
        .improvement {
            background: #E8F5E8;
            border-left: 4px solid #4CAF50;
            padding: 10px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <h1>ğŸš€ Test Page Break Per Item (Cáº£i Tiáº¿n)</h1>
    
    <div class="improvement">
        <h3>âœ¨ Cáº£i tiáº¿n má»›i:</h3>
        <ul>
            <li><strong>Kiá»ƒm tra page break tá»«ng item</strong> thay vÃ¬ tá»«ng dÃ²ng</li>
            <li><strong>Æ¯á»›c tÃ­nh chiá»u cao item</strong> trÆ°á»›c khi render</li>
            <li><strong>Tá»‘i Æ°u performance</strong> - giáº£m sá»‘ láº§n kiá»ƒm tra page break</li>
            <li><strong>Items Ä‘Æ°á»£c coi nhÆ° Ä‘Æ¡n vá»‹ hoÃ n chá»‰nh</strong></li>
        </ul>
    </div>
    
    <div class="test-section">
        <h3>Test Cases:</h3>
        <button onclick="testItemBasedPageBreak()" class="highlight">ğŸ¯ Test Page Break Per Item</button>
        <button onclick="testMixedItemSizes()">ğŸ“ Test Mixed Item Sizes</button>
        <button onclick="testRealWorldContract()">ğŸ“‹ Test Real Contract</button>
        <button onclick="testPerformanceComparison()">âš¡ Test Performance</button>
    </div>
    
    <script>
        function testItemBasedPageBreak() {
            const pdf = new JsPdfService();
            
            pdf.addTitle("Test Page Break Per Item (Cáº£i Tiáº¿n Má»›i)");
            pdf.addSpace(10);
            
            // ThÃªm content Ä‘á»ƒ Ä‘áº©y xuá»‘ng gáº§n cuá»‘i trang
            for (let i = 1; i <= 32; i++) {
                pdf.addText(`Content filler ${i}`, null, null, { fontSize: 9 });
            }
            
            pdf.addSpace(5);
            pdf.addText("ğŸ¯ DANH SÃCH Vá»šI PAGE BREAK PER ITEM:", null, null, {
                fontSize: 12,
                fontStyle: "bold",
                color: [0, 100, 0]
            });
            pdf.addSpace(3);
            
            // Test vá»›i cÃ¡c items cÃ³ Ä‘á»™ dÃ i khÃ¡c nhau
            pdf.addNumberedList([
                "Item 1: Ngáº¯n",
                
                "Item 2: DÃ i - " + "Lorem ipsum dolor sit amet, consectetur adipiscing elit. ".repeat(8) + 
                "Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam.",
                
                "Item 3: Trung bÃ¬nh - Nulla facilisi morbi tempus iaculis urna id volutpat lacus laoreet non.",
                
                "Item 4: Ráº¥t dÃ i - " + "Vestibulum ante ipsum primis in faucibus orci luctus. ".repeat(12) +
                "Mauris viverra venec netus et malesuada fames ac turpis egestas integer.",
                
                "Item 5: Ngáº¯n láº¡i",
                
                "Item 6: Cá»±c dÃ i - " + "Suspendisse potenti nullam ac tortor vitae purus faucibus ornare. ".repeat(15) +
                "In hac habitasse platea dictumst vestibulum rhoncus est pellentesque elit ullamcorper."
            ], {
                itemOptions: {
                    fontSize: 10,
                    align: "justify",
                    numberStyle: "decimal"
                }
            });
            
            pdf.addSpace(10);
            pdf.addText("âœ… Má»—i item Ä‘Æ°á»£c kiá»ƒm tra page break riÃªng biá»‡t", null, null, {
                fontSize: 11,
                color: [0, 150, 0],
                fontStyle: "bold"
            });
            
            pdf.previewPDF();
        }
        
        function testMixedItemSizes() {
            const pdf = new JsPdfService();
            
            pdf.addTitle("Test Mixed Item Sizes");
            pdf.addSpace(10);
            
            // Äáº©y xuá»‘ng
            for (let i = 1; i <= 35; i++) {
                pdf.addText(`Setup line ${i}`, null, null, { fontSize: 8 });
            }
            
            const items = [];
            for (let i = 1; i <= 10; i++) {
                if (i % 3 === 1) {
                    // Items ngáº¯n
                    items.push(`Item ${i}: Ngáº¯n`);
                } else if (i % 3 === 2) {
                    // Items trung bÃ¬nh
                    items.push(`Item ${i}: Trung bÃ¬nh - ` + "Text Ä‘á»ƒ test Ä‘á»™ dÃ i vá»«a pháº£i. ".repeat(3));
                } else {
                    // Items dÃ i
                    items.push(`Item ${i}: DÃ i - ` + "Text dÃ i Ä‘á»ƒ test page break per item. ".repeat(8));
                }
            }
            
            pdf.addNumberedList(items, {
                itemOptions: {
                    fontSize: 10,
                    align: "left",
                    numberStyle: "roman"
                }
            });
            
            pdf.previewPDF();
        }
        
        function testRealWorldContract() {
            const pdf = new JsPdfService();
            
            pdf.addTitle("Test Real World - Há»£p Äá»“ng");
            pdf.addSpace(10);
            
            // Äáº©y xuá»‘ng gáº§n cuá»‘i trang
            for (let i = 1; i <= 30; i++) {
                pdf.addText(`Äiá»u ${i}: Ná»™i dung há»£p Ä‘á»“ng máº«u`, null, null, { fontSize: 9 });
            }
            
            pdf.addText("Äiá»u 7. Cam káº¿t báº£o máº­t thÃ´ng tin cá»§a BÃªn B", null, null, {
                fontSize: 12,
                fontStyle: "bold"
            });
            pdf.addSpace(3);
            
            // Ná»™i dung thá»±c tá»« há»£p Ä‘á»“ng
            pdf.addNumberedList([
                `"ThÃ´ng tin máº­t" cá»§a CÃ´ng ty TNHH XNK TM CN DV HÃ¹ng Duy vÃ  cÃ¡c ÄÆ¡n vá»‹ thÃ nh viÃªn trá»±c thuá»™c lÃ  bao gá»“m nhÆ°ng khÃ´ng giá»›i háº¡n nhá»¯ng ná»™i dung sau Ä‘Ã¢y: bÃ­ máº­t cÃ´ng nghá»‡, bÃ­ máº­t kinh doanh, thÃ´ng tin khÃ¡ch hÃ ng, káº¿ hoáº¡ch tÃ i chÃ­nh, chiáº¿n lÆ°á»£c cÃ´ng ty,... vÃ  cÃ¡c thÃ´ng tin, tÃ i liá»‡u, Ã½ tÆ°á»Ÿng thá»ƒ hiá»‡n hoáº·c lÆ°u trá»¯ dÆ°á»›i dáº¡ng vÄƒn báº£n, dá»¯ liá»‡u mÃ¡y tÃ­nh, thÆ° Ä‘iá»‡n tá»­, hÃ¬nh áº£nh, mÃ£ code, pháº§n má»m tin há»c,...`,
                
                `BÃªn B Ä‘á»“ng Ã½ vÃ  cam káº¿t vÃ´ Ä‘iá»u kiá»‡n ráº±ng tuyá»‡t Ä‘á»‘i báº£o vá»‡ vÃ  báº£o máº­t thÃ´ng tin máº­t (khÃ´ng Ä‘Æ°á»£c tiáº¿t lá»™, sá»­ dá»¥ng, cung cáº¥p thÃ´ng tin máº­t) cho báº¥t ká»³ cÃ¡ nhÃ¢n, tá»• chá»©c, bÃªn thá»© ba dÆ°á»›i báº¥t ká»³ cÃ¡ch thá»©c vÃ  báº¥t ká»³ lÃ½ do nÃ o (náº¿u chÆ°a nháº­n Ä‘Æ°á»£c sá»± Ä‘á»“ng Ã½ báº±ng vÄƒn báº£n cá»§a BÃªn A) mÃ  BÃªn B cÃ³ Ä‘Æ°á»£c trong quÃ¡ trÃ¬nh lÃ m viá»‡c, cÃ³ liÃªn quan Ä‘áº¿n cÃ´ng viá»‡c vÃ /hoáº·c thuá»™c quyá»n sá»Ÿ há»¯u há»£p phÃ¡p cá»§a mÃ¬nh nhÆ°ng chÆ°a Ä‘Æ°á»£c bá»™c lá»™.`,
                
                `BÃªn B Ä‘á»“ng Ã½ vÃ  cam káº¿t vÃ´ Ä‘iá»u kiá»‡n ráº±ng sáº½ khÃ´ng tiáº¿n hÃ nh báº¥t ká»³ hoáº¡t Ä‘á»™ng giao dá»‹ch (vÃ­ dá»¥: liÃªn há»‡, cung cáº¥p thÃ´ng tin, trao Ä‘á»•i, mua bÃ¡n,...) vá»›i báº¥t ká»³ cÃ¡ nhÃ¢n, tá»• chá»©c, bÃªn thá»© ba vá» thÃ´ng tin máº­t lÃ m áº£nh hÆ°á»Ÿng trá»±c tiáº¿p/giÃ¡n tiáº¿p Ä‘áº¿n quyá»n vÃ  lá»£i Ã­ch há»£p phÃ¡p cá»§a cÃ´ng ty.`
            ], {
                itemOptions: {
                    numberStyle: "number",
                    numberFormat: "-",
                    indent: 4,
                    fontSize: 10.5,
                    align: "justify",
                },
                resetNumbers: true,
            });
            
            pdf.previewPDF();
        }
        
        function testPerformanceComparison() {
            console.time("Performance Test");
            
            const pdf = new JsPdfService();
            
            pdf.addTitle("Performance Test - Page Break Per Item");
            pdf.addSpace(10);
            
            // Táº¡o nhiá»u items Ä‘á»ƒ test performance
            const manyItems = [];
            for (let i = 1; i <= 50; i++) {
                if (i % 5 === 0) {
                    manyItems.push(`Item ${i}: Ráº¥t dÃ i - ` + "Text láº·p láº¡i Ä‘á»ƒ test performance. ".repeat(6));
                } else if (i % 3 === 0) {
                    manyItems.push(`Item ${i}: Trung bÃ¬nh - ` + "Text vá»«a pháº£i. ".repeat(2));
                } else {
                    manyItems.push(`Item ${i}: Ngáº¯n`);
                }
            }
            
            console.log(`Generating ${manyItems.length} items...`);
            
            pdf.addNumberedList(manyItems, {
                itemOptions: {
                    fontSize: 9,
                    align: "left",
                    numberStyle: "decimal"
                }
            });
            
            console.timeEnd("Performance Test");
            console.log("âœ… Performance test completed!");
            
            pdf.previewPDF();
        }
        
        console.log("ğŸš€ Test Page Break Per Item loaded!");
        console.log("Improvements:");
        console.log("- Page break check per item (not per line)");
        console.log("- Estimated height calculation");
        console.log("- Optimized performance");
        console.log("- Items treated as complete units");
    </script>
</body>
</html>