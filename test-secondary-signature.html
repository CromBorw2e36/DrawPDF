<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Test Secondary Signature (Ch·ªØ k√Ω nh√°y)</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="fonts/Roboto-Regular-normal.js"></script>
    <script src="fonts/Roboto-Bold-normal.js"></script>
    <script src="fonts/Roboto-Italic-normal.js"></script>
    <script src="fonts/Roboto-BoldItalic-normal.js"></script>
    <script src="jspdf-service.js"></script>
    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 900px;
        margin: 40px auto;
        padding: 20px;
        background: #f5f5f5;
      }
      .container {
        background: white;
        padding: 30px;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }
      h1 {
        color: #333;
        margin-bottom: 10px;
      }
      .subtitle {
        color: #666;
        margin-bottom: 30px;
      }
      .test-section {
        margin-bottom: 30px;
        padding: 20px;
        background: #f9f9f9;
        border-radius: 5px;
        border-left: 4px solid #4caf50;
      }
      .test-section h3 {
        margin-top: 0;
        color: #4caf50;
      }
      button {
        background: #4caf50;
        color: white;
        border: none;
        padding: 12px 24px;
        font-size: 16px;
        border-radius: 4px;
        cursor: pointer;
        margin-right: 10px;
        margin-bottom: 10px;
      }
      button:hover {
        background: #45a049;
      }
      button:active {
        transform: translateY(1px);
      }
      .info {
        background: #e3f2fd;
        padding: 15px;
        border-radius: 4px;
        margin-bottom: 20px;
        border-left: 4px solid #2196f3;
      }
      .warning {
        background: #fff3e0;
        padding: 15px;
        border-radius: 4px;
        margin-bottom: 20px;
        border-left: 4px solid #ff9800;
      }
      label {
        display: block;
        margin: 10px 0 5px 0;
        font-weight: bold;
      }
      input[type="text"],
      input[type="file"] {
        width: 100%;
        padding: 8px;
        margin-bottom: 15px;
        border: 1px solid #ddd;
        border-radius: 4px;
        box-sizing: border-box;
      }
      .checkbox-group {
        margin: 15px 0;
      }
      .checkbox-group label {
        display: inline-block;
        margin-right: 20px;
        font-weight: normal;
      }
      .checkbox-group input[type="checkbox"] {
        margin-right: 5px;
      }
      #imagePreview {
        max-width: 200px;
        max-height: 100px;
        margin-top: 10px;
        display: none;
        border: 1px solid #ddd;
        padding: 5px;
        border-radius: 4px;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>üñäÔ∏è Test Secondary Signature (Ch·ªØ k√Ω nh√°y)</h1>
      <p class="subtitle">
        Ki·ªÉm tra ch·ª©c nƒÉng th√™m ch·ªØ k√Ω nh√°y v√†o g√≥c trang PDF
      </p>

      <div class="info">
        <strong>üìå Ch·ªØ k√Ω nh√°y l√† g√¨?</strong><br />
        - Ch·ªØ k√Ω nh·ªè hi·ªÉn th·ªã ·ªü g√≥c trang (top-left, top-right, bottom-left, bottom-right)<br />
        - C√≥ th·ªÉ ch·ªçn nhi·ªÅu v·ªã tr√≠ c√πng l√∫c<br />
        - Hi·ªÉn th·ªã tr√™n T·∫§T C·∫¢ c√°c trang<br />
        - N·∫øu c√≥ h√¨nh: hi·ªÉn th·ªã h√¨nh ·∫£nh ch·ªØ k√Ω<br />
        - N·∫øu kh√¥ng c√≥ h√¨nh: hi·ªÉn th·ªã nameTag d·∫°ng watermark m√†u tr·∫Øng
      </div>

      <!-- Test 1: Ch·ªØ k√Ω nh√°y v·ªõi nameTag -->
      <div class="test-section">
        <h3>Test 1: Ch·ªØ k√Ω nh√°y v·ªõi nameTag (kh√¥ng c√≥ h√¨nh)</h3>
        <p>Hi·ªÉn th·ªã text watermark m√†u tr·∫Øng ·ªü g√≥c trang</p>
        
        <label>NameTag (ch·ªØ kh√¥ng d·∫•u):</label>
        <input type="text" id="nameTag1" value="Nguoi duyet" placeholder="Nguoi duyet" />
        
        <div class="checkbox-group">
          <strong>Ch·ªçn v·ªã tr√≠:</strong><br />
          <label><input type="checkbox" id="pos1_tl" checked /> Top-Left</label>
          <label><input type="checkbox" id="pos1_tr" /> Top-Right</label>
          <label><input type="checkbox" id="pos1_bl" /> Bottom-Left</label>
          <label><input type="checkbox" id="pos1_br" /> Bottom-Right</label>
        </div>
        
        <button onclick="test1()">üìÑ T·∫°o PDF v·ªõi NameTag</button>
      </div>

      <!-- Test 2: Ch·ªØ k√Ω nh√°y v·ªõi h√¨nh ·∫£nh -->
      <div class="test-section">
        <h3>Test 2: Ch·ªØ k√Ω nh√°y v·ªõi h√¨nh ·∫£nh</h3>
        <p>Upload h√¨nh ·∫£nh ch·ªØ k√Ω ƒë·ªÉ hi·ªÉn th·ªã ·ªü g√≥c trang</p>
        
        <label>Ch·ªçn file ·∫£nh ch·ªØ k√Ω:</label>
        <input type="file" id="signatureImage" accept="image/*" onchange="previewImage()" />
        <img id="imagePreview" />
        
        <div class="checkbox-group">
          <strong>Ch·ªçn v·ªã tr√≠:</strong><br />
          <label><input type="checkbox" id="pos2_tl" /> Top-Left</label>
          <label><input type="checkbox" id="pos2_tr" checked /> Top-Right</label>
          <label><input type="checkbox" id="pos2_bl" /> Bottom-Left</label>
          <label><input type="checkbox" id="pos2_br" checked /> Bottom-Right</label>
        </div>
        
        <button onclick="test2()">üñºÔ∏è T·∫°o PDF v·ªõi H√¨nh ·∫£nh</button>
      </div>

      <!-- Test 3: Nhi·ªÅu ch·ªØ k√Ω nh√°y -->
      <div class="test-section">
        <h3>Test 3: Nhi·ªÅu ch·ªØ k√Ω nh√°y c√πng l√∫c</h3>
        <p>Th√™m nhi·ªÅu ch·ªØ k√Ω nh√°y kh√°c nhau v√†o c√πng m·ªôt PDF</p>
        <button onclick="test3()">‚ú® T·∫°o PDF v·ªõi nhi·ªÅu ch·ªØ k√Ω nh√°y</button>
      </div>

      <!-- Test 4: T√†i li·ªáu nhi·ªÅu trang -->
      <div class="test-section">
        <h3>Test 4: T√†i li·ªáu nhi·ªÅu trang</h3>
        <p>Ki·ªÉm tra ch·ªØ k√Ω nh√°y hi·ªÉn th·ªã tr√™n t·∫•t c·∫£ c√°c trang</p>
        <button onclick="test4()">üìö T·∫°o PDF nhi·ªÅu trang</button>
      </div>

      <!-- Test 5: Ch·ªØ k√Ω nh√°y v·ªõi s·ªë trang -->
      <div class="test-section">
        <h3>Test 5: Ch·ªØ k√Ω nh√°y v·ªõi s·ªë trang ‚≠ê M·ªöI</h3>
        <p>Hi·ªÉn th·ªã s·ªë trang sau nameTag (VD: "Nguoi duyet 1", "Nguoi duyet 2"...)</p>
        
        <label>NameTag (ch·ªØ kh√¥ng d·∫•u):</label>
        <input type="text" id="nameTag5" value="Trang" placeholder="Trang" />
        
        <div class="checkbox-group">
          <strong>Ch·ªçn v·ªã tr√≠:</strong><br />
          <label><input type="checkbox" id="pos5_tl" /> Top-Left</label>
          <label><input type="checkbox" id="pos5_tr" checked /> Top-Right</label>
          <label><input type="checkbox" id="pos5_bl" /> Bottom-Left</label>
          <label><input type="checkbox" id="pos5_br" /> Bottom-Right</label>
        </div>
        
        <button onclick="test5()">üî¢ T·∫°o PDF v·ªõi s·ªë trang</button>
      </div>

      <div class="warning">
        <strong>‚ö†Ô∏è L∆∞u √Ω:</strong><br />
        - NameTag n√™n d√πng ch·ªØ kh√¥ng d·∫•u ƒë·ªÉ hi·ªÉn th·ªã t·ªët<br />
        - K√≠ch th∆∞·ªõc m·∫∑c ƒë·ªãnh: 15x15mm (nh·ªè g·ªçn)<br />
        - Ch·ªØ k√Ω nh√°y s·∫Ω t·ª± ƒë·ªông xu·∫•t hi·ªán khi t·∫°o trang m·ªõi
      </div>
    </div>

    <script>
      // Preview ·∫£nh khi upload
      function previewImage() {
        const file = document.getElementById("signatureImage").files[0];
        const preview = document.getElementById("imagePreview");
        
        if (file) {
          const reader = new FileReader();
          reader.onload = function (e) {
            preview.src = e.target.result;
            preview.style.display = "block";
          };
          reader.readAsDataURL(file);
        } else {
          preview.style.display = "none";
        }
      }

      // Test 1: NameTag watermark
      function test1() {
        try {
          const pdfService = new JsPdfService();
          const nameTag = document.getElementById("nameTag1").value || "Nguoi duyet";
          
          // L·∫•y v·ªã tr√≠ ƒë√£ ch·ªçn
          const positions = [];
          if (document.getElementById("pos1_tl").checked) positions.push("top-left");
          if (document.getElementById("pos1_tr").checked) positions.push("top-right");
          if (document.getElementById("pos1_bl").checked) positions.push("bottom-left");
          if (document.getElementById("pos1_br").checked) positions.push("bottom-right");
          
          if (positions.length === 0) {
            alert("Vui l√≤ng ch·ªçn √≠t nh·∫•t 1 v·ªã tr√≠!");
            return;
          }

          // Th√™m ch·ªØ k√Ω nh√°y
          pdfService.addSecondarySignature({
            nameTag: nameTag,
            positions: positions,
            width: 15,
            height: 15,
            margin: 5,
            fontSize: 8,
            showPageNumber: true // Hi·ªÉn th·ªã s·ªë trang ·ªü sau nameTag
          });

          // Th√™m n·ªôi dung
          pdfService.addTitle("TEST CH·ªÆ K√ù NH√ÅY V·ªöI NAMETAG", { fontSize: 18 });
          pdfService.addSpace(10);
          pdfService.addText("ƒê√¢y l√† t√†i li·ªáu test ch·ªØ k√Ω nh√°y v·ªõi nameTag watermark.");
          pdfService.addSpace(10);
          pdfService.addText(`NameTag: "${nameTag}"`);
          pdfService.addText(`V·ªã tr√≠: ${positions.join(", ")}`);
          pdfService.addSpace(10);
          pdfService.addText("Ch·ªØ k√Ω nh√°y hi·ªÉn th·ªã d·∫°ng watermark m√†u tr·∫Øng ·ªü g√≥c trang.");
          pdfService.addText("B·∫°n c√≥ th·ªÉ th·∫•y text m·ªù ·ªü c√°c g√≥c ƒë√£ ch·ªçn.");

          // Xu·∫•t PDF
          pdfService.savePDF("test-secondary-signature-nametag.pdf");
          alert("‚úÖ T·∫°o PDF th√†nh c√¥ng! Ki·ªÉm tra g√≥c trang ƒë·ªÉ th·∫•y nameTag watermark.");
        } catch (error) {
          console.error("L·ªói:", error);
          alert("‚ùå C√≥ l·ªói x·∫£y ra: " + error.message);
        }
      }

      // Test 2: H√¨nh ·∫£nh ch·ªØ k√Ω
      async function test2() {
        try {
          const file = document.getElementById("signatureImage").files[0];
          if (!file) {
            alert("Vui l√≤ng ch·ªçn file ·∫£nh!");
            return;
          }

          // L·∫•y v·ªã tr√≠ ƒë√£ ch·ªçn
          const positions = [];
          if (document.getElementById("pos2_tl").checked) positions.push("top-left");
          if (document.getElementById("pos2_tr").checked) positions.push("top-right");
          if (document.getElementById("pos2_bl").checked) positions.push("bottom-left");
          if (document.getElementById("pos2_br").checked) positions.push("bottom-right");
          
          if (positions.length === 0) {
            alert("Vui l√≤ng ch·ªçn √≠t nh·∫•t 1 v·ªã tr√≠!");
            return;
          }

          // ƒê·ªçc ·∫£nh
          const reader = new FileReader();
          reader.onload = function (e) {
            const imageData = e.target.result;

            const pdfService = new JsPdfService();

            // Th√™m ch·ªØ k√Ω nh√°y v·ªõi h√¨nh ·∫£nh
            pdfService.addSecondarySignature({
              imageData: imageData,
              nameTag: "Fallback",
              positions: positions,
              width: 20,
              height: 20,
              margin: 5,
            });

            // Th√™m n·ªôi dung
            pdfService.addTitle("TEST CH·ªÆ K√ù NH√ÅY V·ªöI H√åNH ·∫¢NH", { fontSize: 18 });
            pdfService.addSpace(10);
            pdfService.addText("ƒê√¢y l√† t√†i li·ªáu test ch·ªØ k√Ω nh√°y v·ªõi h√¨nh ·∫£nh.");
            pdfService.addSpace(10);
            pdfService.addText(`V·ªã tr√≠: ${positions.join(", ")}`);
            pdfService.addText(`K√≠ch th∆∞·ªõc: 20x20mm`);
            pdfService.addSpace(10);
            pdfService.addText("H√¨nh ·∫£nh ch·ªØ k√Ω hi·ªÉn th·ªã ·ªü c√°c g√≥c ƒë√£ ch·ªçn.");
            pdfService.addText("Ch·ªØ k√Ω n√†y s·∫Ω xu·∫•t hi·ªán tr√™n m·ªçi trang.");

            // Xu·∫•t PDF
            pdfService.savePDF("test-secondary-signature-image.pdf");
            alert("‚úÖ T·∫°o PDF th√†nh c√¥ng! Ki·ªÉm tra g√≥c trang ƒë·ªÉ th·∫•y h√¨nh ·∫£nh ch·ªØ k√Ω.");
          };
          reader.readAsDataURL(file);
        } catch (error) {
          console.error("L·ªói:", error);
          alert("‚ùå C√≥ l·ªói x·∫£y ra: " + error.message);
        }
      }

      // Test 3: Nhi·ªÅu ch·ªØ k√Ω nh√°y
      function test3() {
        try {
          const pdfService = new JsPdfService();

          // Th√™m ch·ªØ k√Ω nh√°y 1 - g√≥c tr√™n tr√°i
          pdfService.addSecondarySignature({
            nameTag: "Nguoi lap",
            positions: ["top-left"],
            width: 12,
            height: 12,
            margin: 5,
            fontSize: 7,
          });

          // Th√™m ch·ªØ k√Ω nh√°y 2 - g√≥c tr√™n ph·∫£i
          pdfService.addSecondarySignature({
            nameTag: "Nguoi duyet",
            positions: ["top-right"],
            width: 15,
            height: 15,
            margin: 5,
            fontSize: 8,
          });

          // Th√™m ch·ªØ k√Ω nh√°y 3 - g√≥c d∆∞·ªõi tr√°i
          pdfService.addSecondarySignature({
            nameTag: "Ke toan",
            positions: ["bottom-left"],
            width: 13,
            height: 13,
            margin: 5,
            fontSize: 7,
          });

          // Th√™m n·ªôi dung
          pdfService.addTitle("TEST NHI·ªÄU CH·ªÆ K√ù NH√ÅY", { fontSize: 18 });
          pdfService.addSpace(10);
          pdfService.addText("T√†i li·ªáu n√†y c√≥ 3 ch·ªØ k√Ω nh√°y ·ªü c√°c g√≥c kh√°c nhau:");
          pdfService.addSpace(5);
          pdfService.addText("‚Ä¢ G√≥c tr√™n tr√°i: Nguoi lap (12x12mm)");
          pdfService.addText("‚Ä¢ G√≥c tr√™n ph·∫£i: Nguoi duyet (15x15mm)");
          pdfService.addText("‚Ä¢ G√≥c d∆∞·ªõi tr√°i: Ke toan (13x13mm)");
          pdfService.addSpace(10);
          pdfService.addText("M·ªói ch·ªØ k√Ω c√≥ k√≠ch th∆∞·ªõc v√† v·ªã tr√≠ kh√°c nhau.");

          // Xu·∫•t PDF
          pdfService.savePDF("test-multiple-secondary-signatures.pdf");
          alert("‚úÖ T·∫°o PDF th√†nh c√¥ng! Ki·ªÉm tra 3 g√≥c trang ƒë·ªÉ th·∫•y c√°c ch·ªØ k√Ω nh√°y.");
        } catch (error) {
          console.error("L·ªói:", error);
          alert("‚ùå C√≥ l·ªói x·∫£y ra: " + error.message);
        }
      }

      // Test 4: Nhi·ªÅu trang
      function test4() {
        try {
          const pdfService = new JsPdfService();

          // Th√™m ch·ªØ k√Ω nh√°y
          pdfService.addSecondarySignature({
            nameTag: "Duyet",
            positions: ["top-right", "bottom-left"],
            width: 15,
            height: 15,
            margin: 5,
            fontSize: 8,
          });

          // Trang 1
          pdfService.addTitle("TRANG 1", { fontSize: 18 });
          pdfService.addSpace(10);
          pdfService.addText("ƒê√¢y l√† trang ƒë·∫ßu ti√™n c·ªßa t√†i li·ªáu.");
          pdfService.addText("Ch·ªØ k√Ω nh√°y hi·ªÉn th·ªã ·ªü g√≥c tr√™n ph·∫£i v√† g√≥c d∆∞·ªõi tr√°i.");
          
          // Th√™m nhi·ªÅu n·ªôi dung ƒë·ªÉ t·∫°o nhi·ªÅu trang
          for (let i = 0; i < 30; i++) {
            pdfService.addSpace(10);
            pdfService.addText(`D√≤ng n·ªôi dung th·ª© ${i + 1} - Lorem ipsum dolor sit amet, consectetur adipiscing elit.`);
          }

          // Trang 2 (t·ª± ƒë·ªông t·∫°o b·ªüi checkPageBreak)
          pdfService.addSpace(20);
          pdfService.addTitle("TRANG 2", { fontSize: 18 });
          pdfService.addText("Ch·ªØ k√Ω nh√°y v·∫´n hi·ªÉn th·ªã tr√™n trang n√†y.");
          
          for (let i = 0; i < 20; i++) {
            pdfService.addSpace(10);
            pdfService.addText(`D√≤ng ${i + 1} c·ªßa trang 2.`);
          }

          // Trang 3
          pdfService.addNewPage();
          pdfService.addTitle("TRANG 3", { fontSize: 18 });
          pdfService.addText("Trang ƒë∆∞·ª£c t·∫°o b·∫±ng addNewPage().");
          pdfService.addText("Ch·ªØ k√Ω nh√°y v·∫´n hi·ªÉn th·ªã ·ªü ƒë√¢y.");

          // Xu·∫•t PDF
          pdfService.savePDF("test-secondary-signature-multi-page.pdf");
          alert("‚úÖ T·∫°o PDF nhi·ªÅu trang th√†nh c√¥ng! Ch·ªØ k√Ω nh√°y hi·ªÉn th·ªã tr√™n T·∫§T C·∫¢ c√°c trang.");
        } catch (error) {
          console.error("L·ªói:", error);
          alert("‚ùå C√≥ l·ªói x·∫£y ra: " + error.message);
        }
      }

      // Test 5: Ch·ªØ k√Ω nh√°y v·ªõi s·ªë trang
      function test5() {
        try {
          const pdfService = new JsPdfService();
          const nameTag = document.getElementById("nameTag5").value || "Trang";
          
          // L·∫•y v·ªã tr√≠ ƒë√£ ch·ªçn
          const positions = [];
          if (document.getElementById("pos5_tl").checked) positions.push("top-left");
          if (document.getElementById("pos5_tr").checked) positions.push("top-right");
          if (document.getElementById("pos5_bl").checked) positions.push("bottom-left");
          if (document.getElementById("pos5_br").checked) positions.push("bottom-right");
          
          if (positions.length === 0) {
            alert("Vui l√≤ng ch·ªçn √≠t nh·∫•t 1 v·ªã tr√≠!");
            return;
          }

          // Th√™m ch·ªØ k√Ω nh√°y v·ªõi showPageNumber = true
          pdfService.addSecondarySignature({
            nameTag: nameTag,
            positions: positions,
            width: 20,
            height: 15,
            margin: 5,
            fontSize: 8,
            showPageNumber: true  // ‚≠ê Hi·ªÉn th·ªã s·ªë trang
          });

          // Trang 1
          pdfService.addTitle("TEST CH·ªÆ K√ù NH√ÅY V·ªöI S·ªê TRANG", { fontSize: 18 });
          pdfService.addSpace(10);
          pdfService.addText("Ch·ªØ k√Ω nh√°y s·∫Ω hi·ªÉn th·ªã s·ªë trang sau nameTag.");
          pdfService.addSpace(10);
          pdfService.addText(`NameTag: "${nameTag}"`);
          pdfService.addText(`Hi·ªÉn th·ªã: "${nameTag} 1", "${nameTag} 2", "${nameTag} 3"...`);
          pdfService.addText(`V·ªã tr√≠: ${positions.join(", ")}`);
          pdfService.addSpace(10);
          pdfService.addText("Ki·ªÉm tra g√≥c trang ƒë·ªÉ th·∫•y s·ªë trang!");
          
          // Th√™m nhi·ªÅu n·ªôi dung ƒë·ªÉ t·∫°o nhi·ªÅu trang
          for (let i = 0; i < 35; i++) {
            pdfService.addSpace(10);
            pdfService.addText(`D√≤ng ${i + 1} - M·ªói trang s·∫Ω c√≥ s·ªë trang ri√™ng.`);
          }

          // Trang 2 (t·ª± ƒë·ªông)
          pdfService.addSpace(20);
          pdfService.addTitle("TRANG 2", { fontSize: 16 });
          pdfService.addText("Ch·ªØ k√Ω nh√°y ·ªü trang n√†y s·∫Ω c√≥ s·ªë 2.");
          
          for (let i = 0; i < 25; i++) {
            pdfService.addSpace(10);
            pdfService.addText(`N·ªôi dung trang 2 - d√≤ng ${i + 1}`);
          }

          // Trang 3
          pdfService.addNewPage();
          pdfService.addTitle("TRANG 3", { fontSize: 16 });
          pdfService.addText("Ch·ªØ k√Ω nh√°y ·ªü trang n√†y s·∫Ω c√≥ s·ªë 3.");
          pdfService.addSpace(10);
          pdfService.addText("T√≠nh nƒÉng n√†y r·∫•t h·ªØu √≠ch ƒë·ªÉ ƒë√°nh d·∫•u s·ªë trang ·ªü g√≥c t√†i li·ªáu!");

          // Trang 4
          pdfService.addNewPage();
          pdfService.addTitle("TRANG 4", { fontSize: 16 });
          pdfService.addText("V√† ti·∫øp t·ª•c v·ªõi s·ªë 4...");

          // Xu·∫•t PDF
          pdfService.savePDF("test-secondary-signature-with-page-number.pdf");
          alert("‚úÖ T·∫°o PDF th√†nh c√¥ng! Ki·ªÉm tra g√≥c trang ƒë·ªÉ th·∫•y s·ªë trang t·ª± ƒë·ªông!");
        } catch (error) {
          console.error("L·ªói:", error);
          alert("‚ùå C√≥ l·ªói x·∫£y ra: " + error.message);
        }
      }
    </script>
  </body>
</html>
