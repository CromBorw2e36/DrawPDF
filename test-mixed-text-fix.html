<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Mixed Text Fix</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://unpkg.com/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
    <script src="fonts/Roboto-Regular-normal.js"></script>
    <script src="fonts/Roboto-Bold-normal.js"></script>
    <script src="fonts/Roboto-Italic-normal.js"></script>
    <script src="fonts/Roboto-BoldItalic-normal.js"></script>
    <script src="jspdf-service.js"></script>
</head>
<body>
    <div class="container my-5">
        <h1 class="text-center mb-4">üîß Test Mixed Text Line Height Fix</h1>
        
        <div class="row justify-content-center">
            <div class="col-md-8">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">Test Mixed Paragraph with Long Content</h5>
                        <p class="card-text">
                            Click the button below to generate a PDF with mixed text that previously had overlapping text issues.
                            This test will verify that the line height fix prevents text from overlapping.
                        </p>
                        
                        <div class="d-grid gap-2">
                            <button class="btn btn-primary" onclick="testMixedTextFix()">
                                üß™ Test Mixed Text Fix
                            </button>
                            <button class="btn btn-success" onclick="testNumberedListFix()">
                                üìù Test Numbered List Fix
                            </button>
                            <button class="btn btn-info" onclick="testBothFixes()">
                                üéØ Test Both Fixes Combined
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        function testMixedTextFix() {
            console.log('üß™ Testing Mixed Text Fix...');
            
            const pdfService = new JsPdfService();
            
            pdfService.addTitle('Test Mixed Text Line Height Fix', {
                fontSize: 18,
                color: [0, 0, 139]
            });
            
            pdfService.addSpace(10);
            
            // Test 1: Very long mixed text that previously overlapped
            pdfService.addSubTitle('Test 1: Long Mixed Content (should not overlap)');
            
            const longMixedText = [
                pdfService.normal('ƒê√¢y l√† m·ªôt ƒëo·∫°n vƒÉn r·∫•t d√†i v·ªõi '),
                pdfService.bold('text ƒë·∫≠m', [255, 0, 0]),
                pdfService.normal(' v√† '),
                pdfService.italic('text nghi√™ng', [0, 128, 0]),
                pdfService.normal(' xen k·∫Ω nhau. '),
                pdfService.boldItalic('N·ªôi dung n√†y ƒë∆∞·ª£c thi·∫øt k·∫ø ƒë·ªÉ test vi·ªác xu·ªëng d√≤ng t·ª± ƒë·ªông ', [0, 0, 255]),
                pdfService.normal('v√† ƒë·∫£m b·∫£o r·∫±ng c√°c d√≤ng kh√¥ng b·ªã ch·ªìng l√™n nhau khi c√≥ '),
                pdfService.colored('nhi·ªÅu font size kh√°c nhau', [255, 128, 0], 'bold', 14),
                pdfService.normal(' trong c√πng m·ªôt paragraph. '),
                pdfService.bold('Text n√†y s·∫Ω ti·∫øp t·ª•c r·∫•t d√†i ƒë·ªÉ test kh·∫£ nƒÉng wrap xu·ªëng nhi·ªÅu d√≤ng m·ªôt c√°ch ch√≠nh x√°c.', [128, 0, 128])
            ];
            
            pdfService.addMixedParagraph(longMixedText, {
                fontSize: 11,
                align: 'justify'
            });
            
            // Test 2: Different font sizes
            pdfService.addSubTitle('Test 2: Mixed Font Sizes');
            
            const mixedSizes = [
                pdfService.normal('Font size 10: '),
                pdfService.colored('Small text', [0, 0, 0], 'normal', 10),
                pdfService.normal(' - Font size 12: '),
                pdfService.colored('Medium text', [0, 100, 0], 'bold', 12),
                pdfService.normal(' - Font size 16: '),
                pdfService.colored('Large text', [255, 0, 0], 'bold', 16),
                pdfService.normal(' - Back to normal. This line should have proper spacing to accommodate the largest font size.')
            ];
            
            pdfService.addMixedParagraph(mixedSizes);
            
            // Test 3: Custom line height
            pdfService.addSubTitle('Test 3: Custom Line Height');
            
            const customLineHeight = [
                pdfService.normal('This paragraph uses custom line height. '),
                pdfService.bold('Lorem ipsum dolor sit amet, consectetur adipiscing elit. '),
                pdfService.italic('Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. '),
                pdfService.normal('Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris.')
            ];
            
            pdfService.addMixedParagraph(customLineHeight, {
                lineHeight: 8, // Custom line height
                fontSize: 12
            });
            
            pdfService.savePDF('mixed-text-fix-test.pdf');
            console.log('‚úÖ Mixed Text Fix test completed!');
        }

        function testNumberedListFix() {
            console.log('üìù Testing Numbered List Fix...');
            
            const pdfService = new JsPdfService();
            
            pdfService.addTitle('Test Numbered List Line Height Fix', {
                fontSize: 18,
                color: [0, 139, 0]
            });
            
            pdfService.addSpace(10);
            
            // Test numbered list with long content
            const longItems = [
                'ƒê√¢y l√† m·ª•c ƒë·∫ßu ti√™n v·ªõi n·ªôi dung r·∫•t d√†i ƒë·ªÉ test vi·ªác xu·ªëng d√≤ng t·ª± ƒë·ªông v√† ƒë·∫£m b·∫£o r·∫±ng c√°c d√≤ng kh√¥ng b·ªã ch·ªìng l√™n nhau khi text qu√° d√†i v√† c·∫ßn wrap sang d√≤ng ti·∫øp theo.',
                'M·ª•c th·ª© hai c≈©ng c√≥ n·ªôi dung d√†i t∆∞∆°ng t·ª± ƒë·ªÉ ki·ªÉm tra t√≠nh nh·∫•t qu√°n trong vi·ªác hi·ªÉn th·ªã v√† spacing gi·ªØa c√°c d√≤ng trong c√πng m·ªôt m·ª•c.',
                {
                    text: 'M·ª•c th·ª© ba v·ªõi font size l·ªõn h∆°n ƒë·ªÉ test kh·∫£ nƒÉng t·ª± ƒë·ªông ƒëi·ªÅu ch·ªânh line height d·ª±a tr√™n font size c·ªßa n·ªôi dung.',
                    options: {
                        fontSize: 13,
                        fontStyle: 'bold',
                        color: [0, 0, 255]
                    }
                },
                'M·ª•c cu·ªëi c√πng v·ªõi n·ªôi dung b√¨nh th∆∞·ªùng ƒë·ªÉ k·∫øt th√∫c test.'
            ];
            
            pdfService.addNumberedList(longItems, {
                title: 'Danh s√°ch test line height:',
                itemOptions: {
                    fontSize: 11,
                    indent: 25
                }
            });
            
            pdfService.addSpace(15);
            
            // Test multi-level list
            pdfService.addSubTitle('Multi-Level List Test');
            
            const multiLevel = [
                {
                    text: 'Level 1 item with very long content that should wrap properly without overlapping the next line or causing spacing issues.',
                    subItems: [
                        'Level 2 sub-item with long content to test nested list line height calculations.',
                        {
                            text: 'Level 2 item with sub-items',
                            subItems: [
                                'Level 3 deep nesting test with long content that wraps multiple lines.',
                                'Another level 3 item for consistency check.'
                            ]
                        }
                    ]
                },
                'Another level 1 item to complete the test.'
            ];
            
            pdfService.addMultiLevelList(multiLevel);
            
            pdfService.savePDF('numbered-list-fix-test.pdf');
            console.log('‚úÖ Numbered List Fix test completed!');
        }

        function testBothFixes() {
            console.log('üéØ Testing Both Fixes Combined...');
            
            const pdfService = new JsPdfService();
            
            pdfService.addTitle('Combined Fix Test - Mixed Text + Numbered Lists', {
                fontSize: 20,
                color: [139, 0, 139]
            });
            
            pdfService.addSpace(10);
            
            // Mixed content first
            const intro = [
                pdfService.bold('Introduction: '),
                pdfService.normal('This document tests both '),
                pdfService.italic('mixed text formatting ', [0, 100, 200]),
                pdfService.normal('and '),
                pdfService.bold('numbered list functionality ', [200, 0, 100]),
                pdfService.normal('together to ensure there are no conflicts between the fixes.')
            ];
            
            pdfService.addMixedParagraph(intro, {
                fontSize: 12
            });
            
            // Numbered list with mixed content items
            const mixedItems = [
                {
                    text: 'First item contains mixed formatting like bold text, italic text, and colored text to verify compatibility.',
                    options: { fontSize: 11 }
                },
                {
                    text: 'Second item with longer content that should wrap properly across multiple lines while maintaining proper indentation and spacing.',
                    options: { fontSize: 12, fontStyle: 'italic' }
                },
                {
                    text: 'Third item uses larger font size to test dynamic line height calculation in numbered lists.',
                    options: { fontSize: 14, fontStyle: 'bold', color: [255, 0, 0] }
                }
            ];
            
            pdfService.addNumberedList(mixedItems, {
                title: 'Mixed Content in Numbered List:',
                spacing: 3
            });
            
            pdfService.addSpace(10);
            
            // Final mixed paragraph
            const conclusion = [
                pdfService.bold('Conclusion: '),
                pdfService.normal('If you can read this without any overlapping text in either the '),
                pdfService.italic('mixed paragraphs '),
                pdfService.normal('or the '),
                pdfService.bold('numbered lists'),
                pdfService.normal(', then both fixes are working correctly! '),
                pdfService.colored('Success!', [0, 150, 0], 'bold', 16)
            ];
            
            pdfService.addMixedParagraph(conclusion);
            
            pdfService.savePDF('combined-fixes-test.pdf');
            console.log('‚úÖ Combined fixes test completed!');
        }

        // Log available functions
        console.log('üîß Mixed Text Fix Test Page Loaded');
        console.log('Available tests:');
        console.log('- testMixedTextFix(): Test mixed paragraph line height fix');
        console.log('- testNumberedListFix(): Test numbered list line height fix'); 
        console.log('- testBothFixes(): Test both fixes together');
    </script>
</body>
</html>